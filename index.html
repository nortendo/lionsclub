<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Lions Club La Louvi√®re - Relais pour la Vie</title>
  <style>
    :root { --orange:#ff7a18; --purple:#6a11cb; }
    body{margin:0;font-family:Inter,Arial,sans-serif;background:linear-gradient(120deg,#5B5FEF,#9C27B0);min-height:100vh;}
    .wrap{max-width:1000px;margin:40px auto;background:#fff;border-radius:16px;box-shadow:0 10px 30px rgba(0,0,0,.15);overflow:hidden}
    header{padding:22px 24px;background:linear-gradient(90deg,var(--orange),#ff3d00);color:#fff;font-weight:800;font-size:32px;letter-spacing:.3px;text-shadow:0 2px 6px rgba(0,0,0,.25)}
    .sub{padding:0 24px 16px;color:#ffe;opacity:.95}
    .tabs{display:flex;gap:0;border-bottom:1px solid #eee;background:#fafafa}
    .tab-button{flex:1;border:0;border-bottom:3px solid transparent;padding:12px 16px;background:#fafafa;cursor:pointer;font-weight:700}
    .tab-button.active{border-color:#5B5FEF;background:#fff;color:#5B5FEF}
    main{padding:18px}
    .row{display:flex;flex-wrap:wrap;gap:12px}
    .card{border:1px solid #eee;border-radius:12px;padding:12px 14px;min-width:220px}
    .kpi{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-top:10px}
    .kpi div{background:#E8F5E9;color:#2E7D32;border-radius:10px;padding:14px;text-align:center;font-weight:700}
    .slot{display:flex;align-items:center;gap:8px;margin:6px 0}
    label{font-size:13px;color:#333}
    select,input,button.action{border:1px solid #ddd;border-radius:8px;padding:8px 10px}
    button.action{background:#5B5FEF;color:#fff;font-weight:700;cursor:pointer}
    .muted{color:#666;font-size:12px}
    .hidden{display:none}
  </style>
</head>
<body>
  <div class="wrap">
    <header>üèÉ Lions Club La Louvi√®re - Relais pour la Vie</header>
    <div class="sub">La Louvi√®re ‚Ä¢ 11-12 Octobre 2025</div>
    <div class="tabs">
      <button class="tab-button active" onclick="switchTab('tshirts')">üëï Tailles T‚ÄëShirts</button>
      <button class="tab-button" onclick="switchTab('planning')">üóìÔ∏è Planning Marche</button>
      <button class="tab-button" onclick="switchTab('resume')">üìä R√©sum√©</button>
    </div>
    <main>
      <section id="tshirts" class="tab-content">
        <h3>S√©lection des tailles</h3>
        <div class="row" id="tshirtsBox"></div>
      </section>
      <section id="planning" class="tab-content hidden">
        <h3>R√©server un cr√©neau (2 personnes / cr√©neau)</h3>
        <div class="row" id="slotsBox"></div>
      </section>
      <section id="resume" class="tab-content hidden">
        <h3>R√©sum√© de l'organisation</h3>
        <div class="kpi">
          <div><span id="k1">0</span><br/>Membres</div>
          <div><span id="k2">0</span><br/>T‚ÄëShirts choisis</div>
          <div><span id="k3">0</span><br/>Cr√©neaux r√©serv√©s</div>
        </div>
        <p class="muted">Les donn√©es sont partag√©es en temps r√©el (Redis Upstash).</p>
      </section>
    </main>
  </div>
  <script>
    // Onglets
    function switchTab(id){
      document.querySelectorAll('.tab-content').forEach(s=>s.classList.add('hidden'));
      document.getElementById(id).classList.remove('hidden');
      document.querySelectorAll('.tab-button').forEach(b=>b.classList.remove('active'));
      const btn = Array.from(document.querySelectorAll('.tab-button')).find(b=>b.getAttribute('onclick').includes(id));
      if(btn) btn.classList.add('active');
    }
    // Donn√©es
    const MEMBERS = ["Yvan D","Michelina C","Pasquale D","Enora D","V√©ronique L","Sandy","Manuela","Christophe G","Pino D","Malika Z","Nolann D","Irina","Le fils de Sandy","Le fils de Manuela","Cyril G","Mario D","Olivier D","Aurore V","Sabrina","Yves E"];
    const SIZES = ["XS","S","M","L","XL","XXL"];
    const SLOTS = [
      "sam 11:00-12:00","sam 12:00-13:00","sam 13:00-14:00","sam 14:00-15:00","sam 15:00-16:00","sam 16:00-17:00","sam 17:00-18:00",
      "dim 08:00-09:00","dim 09:00-10:00","dim 10:00-11:00","dim 11:00-12:00","dim 12:00-13:00","dim 13:00-14:00"
    ];
    async function getState(){ const r = await fetch('/api/state-get'); return r.json(); }
    async function setTshirt(name,size,email=""){
      const r = await fetch('/api/state-set-tshirt',{method:'POST',headers:{'content-type':'application/json'},body:JSON.stringify({name,size,email})});
      return r.json();
    }
    async function setSlot(slotId,name){
      const r = await fetch('/api/state-set-slot',{method:'POST',headers:{'content-type':'application/json'},body:JSON.stringify({slotId,name})});
      return r.json();
    }
    function renderTshirts(state){
      const box = document.getElementById('tshirtsBox'); box.innerHTML='';
      MEMBERS.forEach(m=>{
        const div = document.createElement('div'); div.className='card';
        const sel = document.createElement('select');
        SIZES.forEach(s=>{ const o=document.createElement('option'); o.value=s;o.textContent=s; sel.appendChild(o); });
        sel.value = state.tshirtData[m] || "";
        const btn = document.createElement('button'); btn.textContent='Enregistrer'; btn.className='action';
        btn.onclick = async ()=>{ await setTshirt(m, sel.value); load(); };
        div.innerHTML = `<strong>${m}</strong><br/>`;
        div.appendChild(sel); div.appendChild(document.createElement('br')); div.appendChild(btn);
        box.appendChild(div);
      });
    }
    function renderSlots(state){
      const box = document.getElementById('slotsBox'); box.innerHTML='';
      SLOTS.forEach(id=>{
        const div = document.createElement('div'); div.className='card';
        const sel = document.createElement('select');
        MEMBERS.forEach(m=>{ const o=document.createElement('option'); o.value=m;o.textContent=m; sel.appendChild(o); });
        const btn = document.createElement('button'); btn.textContent='R√©server'; btn.className='action';
        btn.onclick = async ()=>{ await setSlot(id, sel.value); load(); };
        const taken = (state.scheduleData[id]||[]).join(', ') || '‚Äî';
        div.innerHTML = `<strong>${id}</strong><div class="muted">Occup√©: ${taken}</div>`;
        div.appendChild(sel); div.appendChild(document.createElement('br')); div.appendChild(btn);
        box.appendChild(div);
      });
    }
    function renderKpis(state){
      document.getElementById('k1').textContent = state.members.length;
      document.getElementById('k2').textContent = Object.keys(state.tshirtData).length;
      document.getElementById('k3').textContent = Object.values(state.scheduleData).reduce((a,b)=>a+(b?.length||0),0);
    }
    async function load(){
      const state = await getState();
      renderTshirts(state);
      renderSlots(state);
      renderKpis(state);
    }
    load(); setInterval(load, 10000);
  </script>
</body>
</html>
