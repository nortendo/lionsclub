<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lions Club La Louvi√®re - Relais pour la Vie</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; }
        .container { max-width: 1200px; margin: 0 auto; background: white; border-radius: 15px; box-shadow: 0 20px 40px rgba(0,0,0,0.1); overflow: hidden; }
        .header { background: linear-gradient(45deg, #ff6b6b, #ffa500); color: white; padding: 30px; text-align: center; position: relative; }
        .header h1 { font-size: 2.5rem; margin-bottom: 10px; text-shadow: 2px 2px 4px rgba(0,0,0,0.3); }
        .header p { font-size: 1.2rem; opacity: 0.9; }
        .sync-status { position: absolute; top: 15px; right: 15px; display: inline-flex; align-items: center; gap: 6px; padding: 6px 12px; border-radius: 20px; font-size: 0.9rem; font-weight: 600; }
        .sync-status.online { background: rgba(40,167,69,0.2); color: white; }
        .sync-status.offline { background: rgba(220,53,69,0.2); color: white; }
        .sync-status.syncing { background: rgba(255,193,7,0.2); color: white; }
        .tabs { display: flex; background: #f8f9fa; border-bottom: 1px solid #dee2e6; }
        .tab { flex: 1; padding: 15px 20px; text-align: center; cursor: pointer; border: none; background: none; font-size: 1.1rem; font-weight: 600; color: #6c757d; transition: all 0.3s ease; }
        .tab.active { background: white; color: #495057; border-bottom: 3px solid #ff6b6b; }
        .tab:hover:not(.active) { background: #e9ecef; color: #495057; }
        .content { padding: 30px; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .tshirt-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .member-card { background: #f8f9fa; border-radius: 10px; padding: 20px; border: 2px solid #e9ecef; transition: all 0.3s ease; }
        .member-card:hover { border-color: #ff6b6b; transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .member-name { font-weight: bold; font-size: 1.1rem; color: #495057; margin-bottom: 10px; }
        .size-buttons { display: flex; gap: 5px; flex-wrap: wrap; }
        .size-btn { padding: 8px 12px; border: 2px solid #dee2e6; background: white; border-radius: 20px; cursor: pointer; font-weight: 600; transition: all 0.2s ease; min-width: 45px; text-align: center; }
        .size-btn:hover { border-color: #ff6b6b; background: #fff5f5; }
        .size-btn.selected { background: #ff6b6b; color: white; border-color: #ff6b6b; }
        .schedule-container { background: #f8f9fa; border-radius: 10px; padding: 20px; margin-bottom: 20px; }
        .day-header { background: linear-gradient(45deg, #667eea, #764ba2); color: white; padding: 15px; border-radius: 10px; margin-bottom: 15px; text-align: center; font-size: 1.3rem; font-weight: bold; }
        .time-slots { display: grid; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); gap: 10px; }
        .time-slot { background: white; border: 2px solid #dee2e6; border-radius: 8px; padding: 12px; transition: all 0.2s ease; cursor: pointer; }
        .time-slot:hover { border-color: #28a745; background: #f8fff9; }
        .time-slot.assigned { border-color: #28a745; background: #d4edda; }
        .time-range { font-weight: bold; font-size: 1rem; color: #495057; margin-bottom: 5px; }
        .assigned-to { font-size: 0.9rem; color: #155724; font-weight: 600; display: flex; flex-direction: column; gap: 6px; }
        .member-select { width: 100%; padding: 5px; border: 1px solid #ced4da; border-radius: 4px; font-size: 0.9rem; }
        .chip { display: inline-flex; align-items: center; gap: 6px; padding: 4px 8px; background: #20c997; color: white; border-radius: 999px; font-size: 0.85rem; margin: 2px; }
        .chip button { background: rgba(0,0,0,0.15); border: none; color: white; border-radius: 50%; width: 20px; height: 20px; cursor: pointer; display: flex; align-items: center; justify-content: center; }
        .summary { background: linear-gradient(135deg, #28a745, #20c997); color: white; padding: 20px; border-radius: 10px; margin-top: 20px; }
        .summary h3 { margin-bottom: 15px; font-size: 1.3rem; }
        .summary-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; }
        .summary-item { text-align: center; background: rgba(255,255,255,0.1); padding: 15px; border-radius: 8px; }
        .summary-number { font-size: 2rem; font-weight: bold; margin-bottom: 5px; cursor: pointer; text-decoration: underline; }
        .export-btn { background: linear-gradient(45deg, #007bff, #0056b3); color: white; border: none; padding: 12px 24px; border-radius: 25px; font-size: 1rem; font-weight: 600; cursor: pointer; margin: 10px 5px; transition: all 0.3s ease; }
        .export-btn:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0,123,255,0.4); }
        .toolbar { display: flex; gap: 10px; align-items: center; margin-bottom: 12px; }
        .toast { position: fixed; bottom: 24px; right: 24px; background: #212529; color: white; padding: 12px 16px; border-radius: 10px; box-shadow: 0 10px 20px rgba(0,0,0,0.25); opacity: 0; transform: translateY(10px); transition: all .25s ease; pointer-events: none; z-index: 1001; }
        .toast.show { opacity: 1; transform: translateY(0); }
        .toast.error { background: #dc3545; }
        .toast.success { background: #28a745; }
        .pulse { animation: pulse 1s ease-in-out infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        #slotsModal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center; }
        #slotsModal .panel { background: white; padding: 20px; border-radius: 10px; max-width: 700px; width: 92%; max-height: 80vh; overflow: auto; }
        #slotsList button { border: none; padding: 6px 10px; border-radius: 8px; background: #e9ecef; cursor: pointer; margin: 4px 0; text-align: left; width: 100%; }
        #slotsList button:hover { background: #dee2e6; }
        .highlight { animation: flash 1s ease-in-out 2; }
        @keyframes flash { 0% { box-shadow: 0 0 0 0 rgba(40,167,69,0.8) } 50% { box-shadow: 0 0 0 6px rgba(40,167,69,0.25) } 100% { box-shadow: 0 0 0 0 rgba(40,167,69,0) } }
        @media (max-width: 768px) { 
            .header h1 { font-size: 2rem; } 
            .tabs { flex-direction: column; } 
            .content { padding: 20px; } 
            .tshirt-grid { grid-template-columns: 1fr; } 
            .sync-status { position: relative; top: auto; right: auto; margin-top: 10px; }
        }
        .loading { opacity: 0.6; pointer-events: none; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="sync-status" id="syncStatus">
                <span id="syncIcon">üîÑ</span>
                <span id="syncText">Chargement...</span>
            </div>
            <h1>üö∂‚Äç‚ôÇÔ∏è Lions Club La Louvi√®re - Relais pour la Vie</h1>
            <p>La Louvi√®re ‚Ä¢ 11-12 Octobre 2025</p>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="switchTab(event, 'tshirts')">üëï Tailles T-Shirts</button>
            <button class="tab" onclick="switchTab(event, 'schedule')">‚è∞ Planning Marche</button>
            <button class="tab" onclick="switchTab(event, 'summary')">üìä R√©sum√©</button>
        </div>

        <div class="content">
            <div id="tshirts" class="tab-content active">
                <h2 style="margin-bottom: 20px; color: #495057;">S√©lection des tailles de t-shirts</h2>
                <div class="tshirt-grid" id="tshirtGrid"></div>
            </div>

            <div id="schedule" class="tab-content">
                <div class="toolbar">
                    <label for="filterMember">Filtrer par membre :</label>
                    <select id="filterMember" class="member-select" style="max-width:280px" onchange="createSchedule()">
                        <option value="">-- Tous les membres --</option>
                    </select>
                </div>
                <h2 style="margin-bottom: 12px; color: #495057;">Planning des cr√©neaux de marche (jusqu'√† 2 personnes / cr√©neau)</h2>
                <div id="scheduleContainer"></div>
            </div>

            <div id="summary" class="tab-content">
                <div class="summary">
                    <h3>üìà R√©sum√© de l'organisation</h3>
                    <div class="summary-grid">
                        <div class="summary-item">
                            <div class="summary-number" id="totalMembers">0</div>
                            <div>Membres</div>
                        </div>
                        <div class="summary-item">
                            <div class="summary-number" id="tshirtsSelected" onclick="showTshirtSelections()">0</div>
                            <div>T-shirts s√©lectionn√©s (cliquer)</div>
                        </div>
                        <div class="summary-item">
                            <div class="summary-number" id="slotsAssigned" onclick="showAssignedSlots()">0</div>
                            <div>Cr√©neaux assign√©s (cliquer)</div>
                        </div>
                        <div class="summary-item">
                            <div class="summary-number" id="slotsFree" onclick="showFreeSlots()">0</div>
                            <div>Cr√©neaux libres (cliquer)</div>
                        </div>
                        <div class="summary-item">
                            <div class="summary-number" id="totalSlots">0</div>
                            <div>Cr√©neaux totaux</div>
                        </div>
                    </div>
                </div>

                <div style="margin-top: 30px; text-align: center;">
                    <button class="export-btn" onclick="exportTshirtData()">üìã Export T-shirts CSV</button>
                    <button class="export-btn" onclick="exportScheduleData()">üìÖ Export Planning CSV</button>
                    <button class="export-btn" onclick="exportAllData()">üíæ Export Complet JSON</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal for slots -->
    <div id="slotsModal" onclick="closeModalOnBackdrop(event)">
        <div class="panel">
            <h3 id="slotsModalTitle">Cr√©neaux</h3>
            <div id="slotsList" style="margin-top:10px;"></div>
            <div style="display:flex; gap:8px; margin-top:14px; justify-content:flex-end;">
                <button onclick="closeModal()" style="padding: 8px 16px; border: 1px solid #ccc; background: #f8f9fa; border-radius: 4px; cursor: pointer;">Fermer</button>
            </div>
        </div>
    </div>

    <div id="toast" class="toast"></div>

    <script>
        // Global variables
        // --- Backend API (Vercel) ---
        const API = {
            get: '/api/state-get',
            setT: '/api/state-set-tshirt',
            setS: '/api/state-set-slot'
        };

        async function fetchState() {
            updateSyncStatus('syncing','Synchronisation‚Ä¶');
            try{
                const res = await fetch(API.get, { cache:'no-store' });
                const data = await res.json();
                if (data.tshirtData) tshirtData = data.tshirtData;
                if (data.scheduleData) scheduleData = data.scheduleData;
                if (Array.isArray(data.members) && data.members.length) {
                    // merge server members with local list keeping order
                    const merged = Array.from(new Set([ ...members, ...data.members ]));
                    if (merged.length !== members.length) {
                        while (members.length) members.pop();
                        members.push(...merged);
                        initFilter && initFilter();
                    }
                }
                lastSyncTime = Date.now();
                updateSyncStatus('online','Synchronis√©');
            }catch(e){
                console.warn('fetchState error', e);
                updateSyncStatus('offline','Hors ligne (cache local)');
            }
        }

        async function apiSetTshirt(member, size){
            updateSyncStatus('syncing','Envoi‚Ä¶');
            await fetch(API.setT, {
                method:'POST',
                headers:{'content-type':'application/json'},
                body: JSON.stringify({ member, size, members })
            });
            await fetchState();
        }

        async function apiSetSlot(slotId, action, member){
            updateSyncStatus('syncing','Envoi‚Ä¶');
            await fetch(API.setS, {
                method:'POST',
                headers:{'content-type':'application/json'},
                body: JSON.stringify({ slotId, action, member, members })
            });
            await fetchState();
        }

        const members = [
            'Yvan D', 'Christophe G', 'Cyril G', 'Michelina C', 'Pino D', 'Mario D',
            'Pasquale D', 'Malika Z', 'Olivier D', 'Enora D', 'Nolann D', 'Aurore V',
            'Veronique L', 'Irina', 'Sabrina', 'Sandy', 'Le fils de Sandy', 'Yves E',
            'Manuela', 'Le fils de Manuela', 'Sandy L'
        ];
        const sizes = ['XS', 'S', 'M', 'L', 'XL', 'XXL'];
        
        let tshirtData = {};
        let scheduleData = {};
        let isLoading = false;
        let lastSyncTime = 0;

        // Initialize data
        members.forEach(m => { tshirtData[m] = null; });

        // Simulate server storage (using localStorage for demo)
        /* localStorage demo removed */

        // Sync status functions
        function updateSyncStatus(status, text) {
            const statusEl = document.getElementById('syncStatus');
            const iconEl = document.getElementById('syncIcon');
            const textEl = document.getElementById('syncText');
            
            if (!statusEl) return;
            
            statusEl.className = `sync-status ${status}`;
            textEl.textContent = text;
            
            switch (status) {
                case 'online':
                    iconEl.textContent = '‚úÖ';
                    iconEl.classList.remove('pulse');
                    break;
                case 'offline':
                    iconEl.textContent = '‚ùå';
                    iconEl.classList.remove('pulse');
                    break;
                case 'syncing':
                    iconEl.textContent = 'üîÑ';
                    iconEl.classList.add('pulse');
                    break;
            }
        }

        // Tab switching
        function switchTab(evt, tabName) {
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.getElementById(tabName).classList.add('active');
            evt.target.classList.add('active');
            if (tabName === 'summary') updateSummary();
        }

        // T-shirt functions
        function createTshirtGrid() {
            const grid = document.getElementById('tshirtGrid');
            if (!grid) return;
            
            grid.innerHTML = '';
            members.forEach(member => {
                const card = document.createElement('div');
                card.className = 'member-card';
                card.id = `member-${member.replace(/[^a-z0-9]/gi, '-').toLowerCase()}`;
                
                const sizeButtons = sizes.map(size => 
                    `<button class="size-btn ${tshirtData[member] === size ? 'selected' : ''}" onclick="selectSize('${member.replace(/'/g, "\\'")}','${size}')">${size}</button>`
                ).join('');
                
                card.innerHTML = `
                    <div class="member-name">${member}</div>
                    <div class="size-buttons">${sizeButtons}</div>
                `;
                grid.appendChild(card);
            });
        }

        function selectSize(member, size) {
            if (isLoading) return;
            const newVal = (tshirtData[member] === size ? null : size);
            tshirtData[member] = newVal;
            createTshirtGrid();
            updateSummary();
            apiSetTshirt(member, newVal).then(()=>{
                showToast('Taille mise √† jour pour ' + member, 'success');
            }).catch(()=>{
                showToast('Erreur de sauvegarde (r√©essaie)', 'error');
            });
        }

        // Schedule functions
        function initFilter() {
            const sel = document.getElementById('filterMember');
            if (!sel) return;
            
            sel.innerHTML = '<option value="">-- Tous les membres --</option>' + 
                members.map(m => `<option value="${m}">${m}</option>`).join('');
        }

        function generateTimeSlots() {
            const slots = [];
            const startDate = new Date('2025-10-11T15:00:00');
            const endDate = new Date('2025-10-12T15:00:00');
            let current = new Date(startDate);
            
            while (current < endDate) {
                const next = new Date(current.getTime() + 30 * 60000);
                const dayKey = current.toDateString();
                
                if (!slots.find(day => day.date === dayKey)) {
                    slots.push({
                        date: dayKey,
                        day: current.toLocaleDateString('fr-FR', { weekday: 'long', day: 'numeric', month: 'long' }),
                        slots: []
                    });
                }
                
                const daySlots = slots.find(day => day.date === dayKey);
                daySlots.slots.push({
                    id: `${current.getTime()}`,
                    startDate: new Date(current),
                    endDate: new Date(next)
                });
                
                current = next;
            }
            return slots;
        }

        function createSchedule() {
            const container = document.getElementById('scheduleContainer');
            if (!container) return;
            
            const timeSlots = generateTimeSlots();
            const filterValue = (document.getElementById('filterMember') || {value:''}).value || '';

            container.innerHTML = '';
            timeSlots.forEach(day => {
                const dayHasFiltered = day.slots.some(s => {
                    const arr = scheduleData[s.id] || [];
                    return filterValue ? arr.includes(filterValue) : true;
                });
                
                if (!dayHasFiltered) return;

                const dayDiv = document.createElement('div');
                dayDiv.className = 'schedule-container';
                const dayHeader = `<div class="day-header">${day.day}</div>`;
                
                const slotCards = day.slots.map(slot => {
                    const arr = scheduleData[slot.id] || [];
                    if (filterValue && !arr.includes(filterValue)) {
                        return '';
                    }
                    
                    const assignedChips = arr.map((name, idx) => `
                        <span class="chip">${name}
                            <button title="Retirer" onclick="removeAssignee('${slot.id}', ${idx}); event.stopPropagation();">&times;</button>
                        </span>
                    `).join(' ');

                    const selects = (arr.length < 2) ? `
                        <select class="member-select" onchange="assignSlot('${slot.id}', this.value); this.value='';" onclick="event.stopPropagation()">
                            <option value="">+ Ajouter une personne...</option>
                            ${members
                                .filter(m => !arr.includes(m))
                                .map(m => `<option value="${m}">${m}</option>`).join('')}
                        </select>
                    ` : `<em>Max 2 personnes</em>`;

                    const timeRange = `${slot.startDate.toLocaleTimeString('fr-FR',{hour:'2-digit',minute:'2-digit'})} - ${slot.endDate.toLocaleTimeString('fr-FR',{hour:'2-digit',minute:'2-digit'})}`;
                    
                    return `
                        <div id="slot-${slot.id}" class="time-slot ${arr.length ? 'assigned' : ''}" onclick="clearSlot('${slot.id}')">
                            <div class="time-range">${timeRange}</div>
                            <div class="assigned-to">
                                ${assignedChips || '<span style="color:#6c757d">Aucun inscrit</span>'}
                                ${selects}
                            </div>
                        </div>
                    `;
                }).join('');

                dayDiv.innerHTML = dayHeader + `<div class="time-slots">${slotCards}</div>`;
                container.appendChild(dayDiv);
            });
            updateSummary();
        }

        function assignSlot(slotId, member) {
            if (!member || isLoading) return;
            const arr = scheduleData[slotId] || [];
            if (arr.includes(member)) { showToast(member + ' est d√©j√† sur ce cr√©neau.', 'error'); return; }
            if (arr.length >= 2) { showToast('Ce cr√©neau a d√©j√† 2 personnes.', 'error'); return; }
            apiSetSlot(slotId, 'add', member).then(()=>{
                createSchedule();
                updateSummary();
                showToast('Ajout√© : ' + member, 'success');
            }).catch(()=> showToast('Erreur de sauvegarde', 'error'));
        }
            if (arr.length >= 2) { 
                showToast('Ce cr√©neau a d√©j√† 2 personnes.', 'error'); 
                return; 
            }
            
            scheduleData[slotId] = [...arr, member];
            saveToStorage();
            createSchedule();
            showToast('Ajout√© : ' + member, 'success');
        }

        function removeAssignee(slotId, index) {
            if (isLoading) return;
            const arr = scheduleData[slotId] || [];
            const removedMember = arr[index];
            apiSetSlot(slotId, 'remove', removedMember).then(()=>{
                createSchedule();
                updateSummary();
                showToast('Retir√© : ' + removedMember, 'success');
            }).catch(()=> showToast('Erreur de sauvegarde', 'error'));
        }

        function clearSlot(slotId) {
            if (isLoading) return;
            if (!scheduleData[slotId]) return;
            apiSetSlot(slotId, 'clear').then(()=>{
                createSchedule();
                updateSummary();
                showToast('Cr√©neau vid√©', 'success');
            }).catch(()=> showToast('Erreur de sauvegarde', 'error'));
        }
        }

        // Summary functions
        function updateSummary() {
            const totalMembersEl = document.getElementById('totalMembers');
            const tshirtsSelectedEl = document.getElementById('tshirtsSelected');
            const slotsAssignedEl = document.getElementById('slotsAssigned');
            const totalSlotsEl = document.getElementById('totalSlots');
            const slotsFreeEl = document.getElementById('slotsFree');
            
            if (!totalMembersEl) return;
            
            const tshirtsSelected = Object.values(tshirtData).filter(x => x).length;
            const slotsAssigned = Object.values(scheduleData).reduce((acc, arr) => acc + (arr?.length || 0), 0);
            const totalSlots = generateTimeSlots().reduce((acc, day) => acc + day.slots.length, 0);
            const slotsFree = Math.max(totalSlots - slotsAssigned, 0);

            totalMembersEl.textContent = members.length;
            tshirtsSelectedEl.textContent = tshirtsSelected;
            slotsAssignedEl.textContent = slotsAssigned;
            totalSlotsEl.textContent = totalSlots;
            slotsFreeEl.textContent = slotsFree;
        }

        // Export functions
        function exportTshirtData() {
            const data = members.map(member => ({ 
                Membre: member, 
                Taille: tshirtData[member] || 'Non s√©lectionn√©e' 
            }));
            downloadCSV(data, 'tailles-tshirts-relais-vie.csv');
        }

        function exportScheduleData() {
            const entries = Object.entries(scheduleData);
            if (entries.length === 0) { 
                showToast('Aucune donn√©e √† exporter', 'error'); 
                return; 
            }
            
            const rows = [];
            entries.forEach(([slotId, assignees]) => {
                const startDate = new Date(Number(slotId));
                const endDate = new Date(startDate.getTime() + 30*60000);
                const dateLabel = startDate.toLocaleDateString('fr-FR', { weekday: 'long', day: 'numeric', month: 'long' });
                const timeRange = `${startDate.toLocaleTimeString('fr-FR',{hour:'2-digit',minute:'2-digit'})} - ${endDate.toLocaleTimeString('fr-FR',{hour:'2-digit',minute:'2-digit'})}`;
                
                (assignees || []).forEach(person => {
                    rows.push({ 
                        Date: dateLabel, 
                        Heure: timeRange, 
                        'Membre assign√©': person 
                    });
                });
            });
            
            if (!rows.length) { 
                showToast('Aucune donn√©e √† exporter', 'error'); 
                return; 
            }
            downloadCSV(rows, 'planning-marche-relais-vie.csv');
        }

        function exportAllData() {
            const allData = { tshirts: tshirtData, schedule: scheduleData, members };
            const dataStr = JSON.stringify(allData, null, 2);
            const blob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'donnees-relais-vie-complete.json';
            link.click();
            showToast('Export r√©ussi !', 'success');
        }

        function downloadCSV(data, filename) {
            if (!data.length) { 
                showToast('Aucune donn√©e √† exporter', 'error'); 
                return; 
            }
            
            const headers = Object.keys(data[0]);
            const csv = [ 
                headers.join(','), 
                ...data.map(r => headers.map(h => `"${(r[h] ?? '').toString().replace(/"/g,'""')}"`).join(',')) 
            ].join('\n');
            
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a'); 
            a.href = url; 
            a.download = filename; 
            a.click();
            showToast('Export CSV r√©ussi !', 'success');
        }

        // Modal functions
        function closeModal() {
            document.getElementById('slotsModal').style.display = 'none';
        }

        function closeModalOnBackdrop(e) {
            if (e.target && e.target.id === 'slotsModal') {
                closeModal();
            }
        }

        function showTshirtSelections() {
            const listDiv = document.getElementById('slotsList');
            document.getElementById('slotsModalTitle').textContent = 'T-shirts s√©lectionn√©s';
            const selected = Object.entries(tshirtData).filter(([m,v]) => !!v);
            const notSelected = Object.entries(tshirtData).filter(([m,v]) => !v);
            
            let html = "";
            html += "<h4>‚úÖ Avec taille (" + selected.length + ")</h4>";
            if (selected.length) {
                html += "<ul style='padding-left:20px'>";
                selected.sort((a,b) => a[0].localeCompare(b[0])).forEach(([m,v